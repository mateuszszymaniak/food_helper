{% extends 'users/dashboard_base.html' %}
{% load crispy_forms_tags %}
{% block content %}
    <div class="content-section">
        <form method="POST">
            {% csrf_token %}
            {% if form.id %}
            <fieldset class="form-group">
                <legend class="border-bottom mb-4">Edytuj przepis!</legend>

                <div id="div_id_recipe_name" class="form-group">
                    <label for="id_recipe_name" class=" requiredField">Recipe name<span class="asteriskField">*</span></label>
                    <div>
                        <input type="text" name="recipe_name" maxlength="100" class="textinput form-control" required="" id="id_recipe_name" value="{{ form.recipe_name }}">
                    </div>
                </div>

                Ingredient
                <table id="ingredient-table">
                    <thead>
                        <tr>
                            <td>Quantity</td>
                            <td>Quantity type</td>
                            <td>Name</td>
                            <td></td>
                        </tr>
                    </thead>
                    <tbody>
                    {% for ingredient in ingredient_form %}
                        <tr id="">
                        <td>{{ ingredient.quantity }}</td>
                        <td>{{ ingredient.quantity_type }}</td>
                        <td>{{ ingredient.name }}</td>
                            <td><button type="submit" name="edit-{{ ingredient.id }}" class="btn btn-primary">Edit</button></td>
                            <td><button type="button" name="delete-{{ ingredient.id }}" class="btn btn-danger" onclick="delete_ingredient(this)">Usu≈Ñ</button></td>
                        </tr>
                    {% endfor %}

                    </tbody>
                </table>
                <button class="btn btn-primary" type="submit" name="add_ingredient">Add ingredient</button>

                <div id="div_id_preparation" class="form-group">
                    <label for="id_preparation" class=" requiredField">Preparation<span class="asteriskField">*</span></label>
                    <div>
                        <textarea name="preparation" cols="40" rows="10" class="textarea form-control" required="" id="id_preparation">{{ form.preparation }}</textarea>
                    </div>
                </div>

                <div id="div_id_tags" class="form-group">
                    <label for="id_tags" class="">Tags</label>
                    <div>
                        <input type="text" name="tags" class="textinput form-control" id="id_tags" value="{% for tag in form.tags %}{{ tag }}{% endfor %}">
                    </div>
                </div>
            </fieldset>
            <div class="form-group">
                <button class="btn btn-outline-info" type="submit">Zapisz zmiany</button>
            </div>
            {% else %}
            <fieldset class="form-group">
                {{ form.recipe_name|as_crispy_field }}
                Ingredient
                <div>
                    <button class="btn btn-primary" type="submit" name="add_ingredient">Add ingredient</button>
                </div>
                {{ form.preparation|as_crispy_field }}
                {{ form.tags|as_crispy_field }}
            </fieldset>
            <div class="form-group">
                <button class="btn btn-outline-info" type="submit">Add</button>
            </div>
            {% endif %}
        </form>
    </div>
    <script>
    function delete_ingredient(button){
        const row = button.parentNode.parentNode;
        row.parentNode.removeChild(row);
    }
    </script>
{% endblock %}
